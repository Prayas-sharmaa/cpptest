{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Dashboard</h2>

<!-- Row 1: KPI Cards -->
<div class="row mb-4">

    <!-- Total Orders -->
    <div class="col-md-6">
        <div class="card text-bg-info mb-3">
            <div class="card-body">
                <h5 class="card-title">Total Orders</h5>
                <h2>{{ orders|length }}</h2>
            </div>
        </div>
    </div>

    <!-- Low Stock Alert KPI -->
    <div class="col-md-6">
        <div class="card 
            {% if low_stock|length > 0 %}
                text-bg-danger
            {% else %}
                text-bg-success
            {% endif %}
            mb-3">
            <div class="card-body">
                <h5 class="card-title">Low Stock Alert</h5>

                {% if low_stock|length > 0 %}
                    <h4>{{ low_stock|length }} items low</h4>
                    <ul class="mt-2">
                        {% for item in low_stock %}
                            <li>{{ item.name }}: {{ item.qty }}</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <h3>Inventory Healthy ðŸ˜Š</h3>
                {% endif %}
            </div>
        </div>
    </div>

</div>

<!-- Row 2: Orders Table -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">Orders</div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Recipe</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders %}
                        <tr>
                            <td>{{ order.recipe_name }}</td>
                            <td>{{ order.order_status }}</td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="2">No orders yet</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>


<!-- Row 3: Production -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">Production</div>
            <div class="card-body">

                <label>Select a Recipe:</label>
                <select id="sim-recipe" class="form-control mb-3">
                    <option value="">-- Choose Recipe --</option>
                    {% for r in recipes %}
                        <option value="{{ r.recipe_id }}">{{ r.name }}</option>
                    {% endfor %}
                </select>

                <div id="sim-result" class="mt-3"></div>

            </div>
        </div>
    </div>
</div>

<script>
document.getElementById("sim-recipe").addEventListener("change", function () {
    const recipeId = this.value;
    if (!recipeId) {
        document.getElementById("sim-result").innerHTML = "";
        return;
    }

    fetch(`/simulate-data/?recipe_id=${recipeId}`)
        .then(resp => resp.json())
        .then(data => {

            document.getElementById("sim-result").innerHTML = `
                <div class="alert alert-info">
                    <strong>Max Production:</strong> ${data.max_production}
                </div>
                <strong>Projected Inventory After Production:</strong>
                <ul class="mt-2">
                    ${Object.entries(data.inventory_after)
                        .map(([k, v]) => `<li>${k}: ${v}</li>`).join("")}
                </ul>
            `;
        })
        .catch(err => console.error("Simulation error:", err));
});
</script>

{% endblock %}
